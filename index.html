<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Derivador Avanzado</title>
    <script src="https://cdn.jsdelivr.net/npm/algebrite@1.5.0/dist/algebrite.min.js"></script>
</head>
<body>
    <h1>Derivador Avanzado</h1>
    <p>Escribe cualquier función en x y presiona "Derivar".</p>
    <input id="funcion" type="text" placeholder="Ej: sin(x)*x^2 + log(x)">
    <button onclick="derivar()">Derivar</button>
    <pre id="resultado"></pre>

    <script>
        // Limpia y corrige la entrada para Algebrite
        function limpiarEntrada(f) {
            f = f.replace(/\s+/g, '');      // Quitar espacios
            f = f.replace(/\\/g, '^');    // Cambiar ** por ^
            f = f.replace(/(\d)(x)/g, '$1*$2'); // 3x → 3*x
            f = f.replace(/([^\d\^])x/g, '$1*x'); // x después de operador → *x
            return f;
        }

        function derivar() {
            let f = document.getElementById("funcion").value;
            if (!f) {
                document.getElementById("resultado").innerText = "Escribe una función primero.";
                return;
            }
            f = limpiarEntrada(f);

            try {
                // Derivar con Algebrite
                let derivada = Algebrite.run('d(' + f + ', x)');
                document.getElementById("resultado").innerText = derivada;
            } catch (err) {
                document.getElementById("resultado").innerText = "Error: función inválida o sintaxis incorrecta";
            }
        }
    </script>
</body>
</html>
